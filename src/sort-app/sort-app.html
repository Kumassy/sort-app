<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../../bower_components/app-layout/app-header-layout/app-header-layout.html">

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../sort-canvas/sort-canvas.html">
<link rel="import" href="../sort-canvas/sort-locus-canvas.html">

<dom-module id="sort-app">
  <template>
    <style>
      :host {
        display: block;
      }
      .result {
        position: relative;
      }
      .list {
        /*width: 600px;*/
        /*height: 100vh;*/
        overflow: scroll;
        white-space: nowrap;

        position: absolute; top: 0; left: 0;
        /* remove unnecessary space */
        font-size: 0
      }
      sort-locus-canvas {
        position: absolute;
        top: 0;
        left: 0;
        font-size: 0;
      }
      sort-row {
        margin-right: 4px;
      }
      app-toolbar {
        background-color: #4285f4;
        color: #fff;
      }
    </style>
    <app-drawer-layout>
      <app-drawer swipe-ope>
        <paper-listbox style="height: 100%; overflow: auto;" selected="0">
          <template is="dom-repeat" items="[[sortMethod]]">
           <paper-item>
             [[item.0]]
           </paper-item>
           <!-- <paper-item on-tap="_handlePatternListTap" style="justify-content: space-between;">
             {{item.name}}

             <life-icon-toggle pressed="{{item.starred}}"></life-icon-toggle>
           </paper-item> -->
          </template>
          <!-- <div class="">
            hogehogehoge
          </div> -->
        </paper-listbox>
      </app-drawer>

      <app-header-layout>
        <app-header fixed condenses>
          <app-toolbar>
            <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
            <div main-title>Sort Visualizer</div>
          </app-toolbar>
        </app-header>

        <h2>Hello [[prop1]]</h2>
        <sort-canvas id="canvas" array="[[array]]"></sort-canvas>
        <div class="result">
          <sort-locus-canvas array="[[array]]"></sort-locus-canvas>
          <div class="list">
            <template is="dom-repeat" items="[[array]]">
              <!-- <sort-row row="[[item]]" on-tap="_handleTap"></sort-row> -->
              <sort-row row="[[item]]" on-mouseenter="_handleTap"></sort-row>
            </template>
          </div>
        </div>
      </app-header-layout>
    </app-drawer-layout>
  </template>

  <script>
    if (!Array.prototype.shuffle) {
      Array.prototype.shuffle = function() {
        // shallow copy
        var array = [].concat(Object(this));
        var n = array.length, t, i;

        while (n) {
          i = Math.floor(Math.random() * n--);
          t = array[n];
          array[n] = array[i];
          array[i] = t;
        }
        return array;
      }
    }
    Polymer({

      is: 'sort-app',

      properties: {
        prop1: {
          type: String,
          value: 'sort-app',
        },
        array: {
          type: Object,
          value: [],
          notify: true
        },
        arrayLength: {
          type: Number,
          value: 100,
        },
        sortMethod: {
          type: Object,
          value: []
        }
      },

      ready: function(){
        // let seed = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19];
        let seed = Array.from(Array(this.arrayLength).keys());
        let a = [];

        // for(let i = 0; i < 600 - 1; i++){
        //   a.push(seed.shuffle());
        //   // this.push('array', seed.shuffle());
        // }
        // for(let i = 0; i < 1; i++){
        //   a.push(this.quicksort(seed.shuffle()));
        // }

        // a = this.insertionSort(seed.shuffle());
        a = this.bubbleSort(seed.shuffle());

        this.set('array', a);

        // console.log(this.array);


        this.push('sortMethod', ["クイックソート", this.quicksort]);
        this.push('sortMethod', ["挿入ソート", this.insertionSort]);
        this.push('sortMethod', ["バブルソート", this.bubbleSort]);
      },


      quicksort: function(array){
        let result = [];

        let qsort = function(a){
          if(a.length === 0){
            return [];
          }
          else if(a.length === 1){
            return a;
          }
          else if(a.length === 2){
            if(a[0] < a[1]){
              return a;
            } else {
              return a.reverse();
            }
          }
          else{
            let pivot = a[0];
            let rest = a.slice(1);
            let smaller = rest.filter((t) => t <= pivot);
            let larger = rest.filter((t) => t > pivot);

            return qsort(smaller).concat(pivot).concat(qsort(larger));
          }
        }

        return qsort(array);
      },

      insertionSort: function(_array){
        let array = [].concat(_array);
        let result = [];
        result.push([].concat(array));

        for(let i = 1; i < array.length; i++){
          let t = array[i];
          if(array[i - 1] > t){
            let j;
            for(j = i; j > 0 && array[j - 1] > t; j--){
              array[j] = array[j - 1];
              // result.push([].concat(array));
            }
            array[j] = t;
          }
          result.push([].concat(array));
        }

        return result;
      },

      bubbleSort: function(_array){
        let array = [].concat(_array);
        let result = [];

        result.push([].concat(array));
        for(let i = 0; i < array.length; i++){
          for(let j = 0; j < array.length - 1; j++){
            if(array[j + 1] < array[j]){
              [array[j + 1], array[j]] = [array[j], array[j + 1]];
            }
          }
          result.push([].concat(array));
        }

        return result;
      },

      _handleTap: function(e){
        console.log(e);
        this.$.canvas.reDrawAt(e.model.index);
      }
    });
  </script>
</dom-module>

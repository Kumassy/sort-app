<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../sort-canvas/sort-canvas.html">

<dom-module id="sort-app">
  <template>
    <style>
      :host {
        display: block;
      }
      .list {
        width: 600px;
        height: 100vh;
        overflow: scroll;
        white-space: nowrap;
      }

    </style>
    <h2>Hello [[prop1]]</h2>
    <sort-canvas id="canvas" array="[[array]]"></sort-canvas>
    <div class="list">
      <template is="dom-repeat" items="[[array]]">
        <!-- <sort-row row="[[item]]" on-tap="_handleTap"></sort-row> -->
        <sort-row row="[[item]]" on-mouseenter="_handleTap"></sort-row>
      </template>
    </div>
  </template>

  <script>
    if (!Array.prototype.shuffle) {
      Array.prototype.shuffle = function() {
        // shallow copy
        var array = [].concat(Object(this));
        var n = array.length, t, i;

        while (n) {
          i = Math.floor(Math.random() * n--);
          t = array[n];
          array[n] = array[i];
          array[i] = t;
        }
        return array;
      }
    }
    Polymer({

      is: 'sort-app',

      properties: {
        prop1: {
          type: String,
          value: 'sort-app',
        },
        array: {
          type: Object,
          value: [],
          notify: true
        }
      },

      ready: function(){
        // let seed = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19];
        let seed = Array.from(Array(100).keys());
        let a = [];

        for(let i = 0; i < 600 - 1; i++){
          a.push(seed.shuffle());
          // this.push('array', seed.shuffle());
        }
        for(let i = 0; i < 1; i++){
          a.push(this._quicksort(seed.shuffle()));
        }

        this.set('array', a);

        // console.log(this.array);
      },


      _quicksort: function(array){
        let result = [];

        let qsort = function(a){
          if(a.length === 0){
            return [];
          }
          else if(a.length === 1){
            return a;
          }
          else if(a.length === 2){
            if(a[0] < a[1]){
              return a;
            } else {
              return a.reverse();
            }
          }
          else{
            let pivot = a[0];
            let rest = a.slice(1);
            let smaller = rest.filter((t) => t <= pivot);
            let larger = rest.filter((t) => t > pivot);

            return qsort(smaller).concat(pivot).concat(qsort(larger));
          }
        }

        return qsort(array);
      },

      _handleTap: function(e){
        console.log(e);
        this.$.canvas.reDrawAt(e.model.index);
      }
    });
  </script>
</dom-module>
